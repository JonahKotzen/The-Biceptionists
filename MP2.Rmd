---
title: "MP2"
author: "Jonah Kotzen"
date: "2024-02-14"
output: html_document
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
```


```{r load, include = FALSE}

arm_dat <- read_csv("MP2.csv")

# Convert cm to m and g to kg
arm_dat <- arm_dat %>%
  mutate(
    Larm = Larm / 100,
    Li = Li / 100,
    Lout = Lout/ 100,
    Mmuscle = Mmuscle / 1000
  )

``` 

# Dataset for 3 Subjects (Jonah, Scarlett, Ari)

```{r dataset, include=TRUE}

print(arm_dat)

```

# Functions for Calculations

```{r chunk 1, include=TRUE}

law_cos <- function(l, r, o) {
  theta <- acos((-o^2 + l^2 + r^2) / (2 * l * r))
  return(theta)
}

law_cos2 <- function(l, r, theta) {
  o <- sqrt(l^2 + r^2 - 2 * l * r * cos(theta))
  return(o)
}

force_length_factor <- function(Lmuscle, Lmuscler) {
  Lopt <- Lmuscler * 0.8
  ffl <- -6.25 * (Lmuscle / Lopt)^2 + 12.5 * (Lmuscle / Lopt) - 5.25
  return(ffl)
}

calculate_Fmax <- function(Mmuscle, Lmuscler, rho = 0.00105, phi = 0, k = 80) {
  PCSA <- (Mmuscle * cos(phi)) / (rho * Lmuscler)
  Fmax <- PCSA * k
  return(Fmax)
}


```


## The Model Function

```{r chunk5, include=TRUE}
model <- function(Mmuscle, Lmuscler, Lmuscle, theta, Li, rho = 0.00105, k = 80) {
   # Convert Lmuscler from m to cm for PCSA calculation (as ρ is given in kg/cm^3)
  Lmuscler_cm <- Lmuscler * 100
  # Assuming phi is 0 as the muscle is nonpennate
  phi <- 0
  # PCSA calculation
  PCSA <- (Mmuscle * cos(phi)) / (rho * Lmuscler_cm)
  # Fmax calculation
  Fmax <- PCSA * k
  # Force-length relationship factor (ffl)
  ffl <- force_length_factor(Lmuscle, Lmuscler)
  # Muscle force (Fmuscle)
  Fmuscle <- Fmax * ffl
  # Torque calculation (τmuscle)
  tau_muscle <- Fmuscle * sin(theta) * Li
  return(tau_muscle)
}
```


# Applying the Model

## Final Tibble

```{r chunk6, include=FALSE}
angles_tibble <- tibble(
  flexion_deg = c(50, 75, 100, 125, 150),
  flexion_rad = flexion_deg * pi / 180
)

# Assuming g = 9.81 m/s^2
g <- 9.81

# Calculate Lmuscle, theta, muscle_torque, and max_mass for each flexion angle
dat1 <- arm_dat %>%
  cross_join(angles_tibble) %>%
  rowwise() %>%
  mutate(
    Lmuscle = law_cos2(Li, Larm, flexion_rad), 
    theta = law_cos(Li, Lmuscle, Larm)) %>% 
  ungroup()
  
dat2 <- dat1 %>% 
filter (flexion_deg == 150) %>%
mutate(Lmuscler = Lmuscle) %>%
select (subject, Lmuscler)

dat3 <- dat1 %>%
  left_join(dat2, by = "subject")

dat_final <- dat3 %>%
  mutate(
    muscle_torque = model(Mmuscle, Lmuscler, Lmuscle, theta, Li),
    max_mass = muscle_torque / (Lout * g)
  ) %>%
  ungroup()

dat <- dat_final %>%
  select(subject, flexion_rad, Lmuscle, theta, muscle_torque, max_mass)

```

```{r final tib, include=TRUE}

print(dat)

```

# Areas to Address

## What were your predicted τ muscle and Mload values at each flexion angle?

```{r vis, include=TRUE}

# Plot muscle torque for each flexion angle for each subject
ggplot(dat_final, aes(x = flexion_deg, y = muscle_torque, group = subject, color = subject)) +
  geom_line() +
  geom_point() +
  labs(title = "Muscle Torque at Each Flexion Angle",
       x = "Flexion Angle (degrees)",
       y = "Muscle Torque (Nm)")

# Plot max mass for each flexion angle for each subject
ggplot(dat_final, aes(x = flexion_deg, y = max_mass, group = subject, color = subject)) +
  geom_line() +
  geom_point() +
  labs(title = "Max Mass at Each Flexion Angle",
       x = "Flexion Angle (degrees)",
       y = "Max Mass (kg)")


```


## Is there any pattern to these values? What explains these patterns?

- The data shows a trend where muscle torque and max mass generally peak around 75 degrees of flexion for all three subjects, indicating an optimal angle for force generation due to favorable muscle length-tension relationships and lever mechanics. Beyond this angle, both torque and mass support capability decrease, likely due to reduced leverage and less effective muscle contraction angles. This pattern highlights the significance of biomechanics in understanding physical performance.


## How did your gym testing compare to your model estimations? That is, was it more or less than predicted?

- In gym testing, we were able to lift more than the model predicted. 


## If the model was produced poor predictions, why?

- This discrepancy could be due to the model not accounting for synergistic muscle actions, neural adaptations, individual biomechanical differences, and psychological factors that can enhance performance. Essentially, real-world performance can exceed model predictions due to the complex interplay of physiological and psychological factors not fully captured by the model.



